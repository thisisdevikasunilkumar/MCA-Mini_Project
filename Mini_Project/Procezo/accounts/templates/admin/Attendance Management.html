{% extends 'admin/Admin Dashboard.html' %}
{% load static %}

{% block title %}Attendance Management{% endblock %}

{% block extrastyle %}
<!-- Dashboard base CSS -->
<link rel="stylesheet" href="{% static 'css/admin/AdminDashboard.css' %}" />
{% endblock %}

{% block content %}
<!-- Include additional CSS -->
<link rel="stylesheet" href="{% static 'css/admin/AttendanceManagement.css' %}" />
<div class="main">
  <div class="container">
    <h2>Attendance Management</h2>
    <p>Track and manage staff attendance records</p>

    <div class="card-header">
      <h2>Add Staff Check In / Check Out</h2>
    </div>

    <table id="staffListTable" class="data-table"> 
        <thead>
            <tr>
                <th>Staff ID</th>
                <th>Name</th>
                <th>Role</th>
                <th>Job Type</th>
                <th>Check In</th>
                <th>Check Out</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            {% for staff in staff_list %}
              <tr>
                <td>{{ staff.staff_id }}</td>
                <td>{{ staff.name }}</td>
                <td>{{ staff.role }}</td>
                <td>{{ staff.job_type }}</td>
                <td class="check-in-cell">{{ staff.check_in|time:"h:i A"|default:"--:--" }}</td>
                <td class="check-out-cell">{{ staff.check_out|time:"h:i A"|default:"--:--" }}</td>
                <td>
                  <button class="btn btn-primary" id="markAttendanceBtn">Check In / Check Out</button>
                </td>
              </tr>
            {% endfor %}
        </tbody>
    </table>

    <input type="hidden" id="saveAttendanceUrl" value="{% url 'accounts:save_attendanceTime' %}">

    <div id="attendanceModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Mark Check In / Check Out</h3>
            </div>
            <div class="modal-body">
                <form id="attendanceForm">
                    <div class="form-group">
                        <label class="form-label" for="attendanceStaffId">Staff ID</label>
                        <input type="text" id="attendanceStaffId" class="form-input" readonly required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="attendanceName">Staff Name</label>
                        <input type="text" id="attendanceName" class="form-input" readonly required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="attendanceRole">Role</label>
                        <input type="text" id="attendanceRole" class="form-input" readonly required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="attendanceJobType">Job Type</label>
                        <input type="text" id="attendanceJobType" class="form-input" readonly required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="checkInTime">Check In Time</label>
                        <input type="time" id="checkInTime" class="form-input">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="checkOutTime">Check Out Time</label>
                        <input type="time" id="checkOutTime" class="form-input">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelAttendanceBtn">Cancel</button>
                <button class="btn btn-primary" id="saveAttendanceBtn">Save</button>
            </div>
        </div>
    </div>

    <div class="attendanceManagement-stats-grid">
      <div class="attendanceManagement-stat-card">
        <div class="stat-icon">✅</div>
        <div class="stat-value">{{ stats.active_today }}</div>
        <div class="stat-label">Active Today</div>
      </div>

      <div class="attendanceManagement-stat-card">
        <div class="stat-icon">❌</div>
        <div class="stat-value">{{ stats.inactive_today }}</div>
        <div class="stat-label">Inactive Today</div>
      </div>

      <div class="attendanceManagement-stat-card">
        <div class="stat-icon">⏰</div>
        <div class="stat-value">{{ stats.late_today }}</div>
        <div class="stat-label">Late Arrivals Today</div>
      </div>
    </div>

    <div class="card-header">
      <h2>Individual Reports</h2>
    </div>
    <table class="data-table">
      <thead>
        <tr>
          <th>Staff ID</th>
          <th>Staff Name</th>
          <th>Date</th>
          <th>Check In</th>
          <th>Check Out</th>
          <th>Overtime Hours</th>
          <th>Status</th>
        </tr>
      </thead>

      <tbody>
        {% for a in attendance_list %}
        <tr>
          <td>{{ a.staff.staff_id }}</td>
          <td>{{ a.staff.name }}</td>
          <td>{{ a.date }}</td>

          <td>{{ a.check_in|default:"--:--" }}</td>
          <td>{{ a.check_out|default:"--:--" }}</td>

          <td>{{ a.overtime_hours|default:"00:00" }}</td>

          <td>
            {% if a.status == 'Active' %}
                <span class="status-badge active">Active</span>
            {% elif a.status == 'Late' %}
                <span class="status-badge late">Late</span>
            {% elif a.status == 'Inactive' %}
                <span class="status-badge inactive">Inactive</span>
            {% else %}
                <span class="status-badge pending">Pending</span>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<script src="{% static 'js/admin/AttendanceManagement.js' %}"></script>

{% endblock %}