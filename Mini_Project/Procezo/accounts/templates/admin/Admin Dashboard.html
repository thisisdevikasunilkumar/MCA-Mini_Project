{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="author" content="Devika Sunilkumar" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="application-name" content="Procezo Website" />
    <meta name="language" content="English" />
    <title>{% block title %}Admin Dashboard{% endblock %}</title>
    <link rel="icon" type="image/x-icon" href="{% static 'image/procezo-title-logo.png' %}"/>
    <link rel="stylesheet" href="{% static 'css/admin/AdminDashboard.css' %}"/>
  </head>
  <body>
    <script type="text/javascript">
        function preventBack() {
            window.history.forward();
        }
        setTimeout("preventBack()", 0);
        window.onunload = function () { null };
    </script>
    <!-- ================= aside ================= -->
    <aside id="home-page">
      <nav class="sidebar">
        <div class="top-section">
          <!-- Logo -->
          <img src="{% static 'image/procezo-logo-white.png' %}" alt="Procezo Logo" class="logo" />
          <ul class="menu">
            <li><a href="{% url 'accounts:admin_dashboard' %}"><img src="{% static 'image/dashboard/AdminHome.png' %}" class="icon" /><span>Home</span></a></li>
            <li><a href="{% url 'accounts:admin_staff_management' %}"><img src="{% static 'image/dashboard/Staff.png' %}" class="icon" /><span>Staff Management</span></a></li>
            <li><a href="{% url 'accounts:admin_attendance_management' %}"><img src="{% static 'image/dashboard/Attendance.png' %}" class="icon" /><span>Attendance</span></a></li>
            <li><a href="{% url 'accounts:admin_work_schedule_list' %}"><img src="{% static 'image/dashboard/work schedule.png' %}" class="icon" /><span>Work Schedule</span></a></li>
            <li><a href="#"><img src="{% static 'image/dashboard/key logs.png' %}" class="icon" /><span>Key Logs</span></a></li>
            <li><a href="{% url 'accounts:admin_emotion_management' %}"><img src="{% static 'image/dashboard/Emotion.png' %}" class="icon" /><span>Emotion</span></a></li>
            <!-- <li><a href="#"><img src="{% static 'image/dashboard/Salary.png' %}" class="icon" /><span>Salary</span></a></li> -->
          </ul>
        </div>

        <!-- Bottom section -->
        <div class="bottom-section">
          <img src="{% static 'image/dashboard/admin.png' %}" alt="Admin" class="admin-icon" />
        </div>
      </nav>
    </aside>
    <!-- ================= main CONTENT ================= -->
    <div class="main-content">
      <header class="staff-header">
        <div class="left-box">
          <div class="title-row">
            <h1>Admin Dashboard
              <span class="role-tag">Administrator</span>
            </h1>

            <form method="GET" action="{% url 'accounts:admin_staff_search' %}" class="search-wrapper">
                <img src="{% static 'image/dashboard/search.png' %}" 
                    class="search-icon" 
                    onclick="this.closest('form').submit();">
              <input type="text" name="q" placeholder="Search staff..." class="search-box" />
            </form>
          </div>         
        </div>
        
        <a href="{% url 'accounts:login_register' %}">
          <button class="logout-btn">
            <div class="sign">
              <svg viewBox="0 0 512 512">
                <path d="M377.9 105.9L500.7 228.7c7.2 7.2 11.3 17.1 11.3 27.3s-4.1 20.1-11.3 27.3L377.9 406.1c-6.4 6.4-15 9.9-24 9.9c-18.7 0-33.9-15.2-33.9-33.9l0-62.1-128 0c-17.7 0-32-14.3-32-32l0-64c0-17.7 14.3-32 32-32l128 0 0-62.1c0-18.7 15.2-33.9 33.9-33.9c9 0 17.6 3.6 24 9.9zM160 96L96 96c-17.7 0-32 14.3-32 32l0 256c0 17.7 14.3 32 32 32l64 0c17.7 0 32 14.3 32 32s-14.3 32-32 32l-64 0c-53 0-96-43-96-96L0 128C0 75 43 32 96 32l64 0c17.7 0 32 14.3 32 32s-14.3 32-32 32z"/>
              </svg>
            </div>
            <div class="logout-btn-text">Logout</div>
          </button>
        </a>
      </header>

      <!-- CONTENT BLOCK -->
      {% block content %}
      <!-- ====== Stats Grid ====== -->
      <div class="stats-grid">
        <div class="stat-card" id="statCard1">
          <div class="stat-icon" id="statIcon1">üë•</div>
          <div class="stat-value" id="statValue1">{{ staff_count }}</div>
          <div class="stat-label" id="statLabel1">Total Staff</div>
        </div>

        <div class="stat-card" id="statCard2">
          <div class="stat-icon" id="statIcon2">‚úÖ</div>
          <div class="stat-value" id="statValue2">{{ stats.active_today }}</div>
          <div class="stat-label" id="statLabel2">Present Today</div>
        </div>

        <div class="stat-card" id="statCard3">
          <div class="stat-icon" id="statIcon3">‚ùå</div>
          <div class="stat-value" id="statValue3">{{ stats.inactive_today }}</div>
          <div class="stat-label" id="statLabel3">On Leave</div>
        </div>

        <div class="stat-card" id="statCard4">
          <div class="stat-icon" id="statIcon4">üéÇ</div>
          <div class="stat-value" id="statValue4">{{ birthday_this_week_count }}</div>
          <div class="stat-label" id="statLabel4">Birthdays This Week</div>
        </div>
      </div>

      <!-- ====== Content 2 Column Layout ====== -->
      <div class="content-grid">
        <!-- Tasks Card -->
        <div class="content-grid-card" id="tasksCard">
          <div class="card-header">
            <h2 id="tasksTitle">Recent Staff</h2>
          </div>

          <table class="staff-table">
            <thead>
              <tr>
                <th>Name</th>
                <th>Email</th>
                <th>Status</th>
                <th>Joined</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for staff in recent_staff %}
              <tr>
                <td>
                  <div class="staff-name-cell">
                    <div class="staff-avatar">
                      {{ staff.name|slice:":1" }}{{ staff.name|slice:"1:2" }}
                    </div>
                    <div>
                      <div class="staff-name">{{ staff.name }}</div>
                      <div class="staff-email">{{ staff.job_type|default:"No role" }}</div>
                    </div>
                  </div>
                </td>

                <td class="staff-email">{{ staff.email }}</td>

                <td>
                  {% if staff.attendances.exists %}
                    <span class="staff-status active">
                      {{ staff.attendances.last.status }}
                    </span>
                  {% else %}
                    <span class="staff-status away">No Records</span>
                  {% endif %}
                </td>

                <td>{{ staff.created_at|date:"M d, Y" }}</td>

                <td><button class="action-btn">View</button></td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="5" style="text-align:center;">No staff registered</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

        <!-- Announcements Card -->
      <div class="content-grid-card" id="announcementsCard">
        <div class="card-header">
            <h2 id="announcementsTitle">üéÇ Upcoming Birthdays</h2>
        </div>

        <div class="birthday-list">
            {% for b in upcoming_birthdays %}
            <div class="birthday-item">
                <div class="birthday-avatar">
                    {{ b.name|slice:":1" }}{{ b.name|slice:"1:2" }}
                </div>

                <div class="birthday-info">
                    <p class="birthday-name">{{ b.name }}</p>

                    {% if b.dob.month == today.month and b.dob.day == today.day %}
                        <p class="birthday-date">Today - {{ b.dob|date:"M d" }}</p>
                    {% elif b.dob.month == tomorrow.month and b.dob.day == tomorrow.day %}
                        <p class="birthday-date">Tomorrow - {{ b.dob|date:"M d" }}</p>
                    {% else %}
                        <p class="birthday-date">{{ b.dob|date:"M d" }}</p>
                    {% endif %}
                </div>

                <div class="birthday-icon">üéâ</div>
            </div>
            {% empty %}
            <p style="padding: 20px;">No upcoming birthdays üéà</p>
            {% endfor %}
        </div>
      </div>

      </div>

      <!-- ====== Schedule ====== -->
      <div class="section-card">
        <div class="section-header">
          <h2 id="schedule-title">Today's Schedule</h2>
          <button class="meet-link-btn" onclick="addMeetingLink(this)">
            <svg class="meet-icon" viewBox="0 0 24 24">
              <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
            </svg>
            Add Link
          </button>
        </div>

        <div class="schedule-list">
          {% for meeting in todays_meetings %}
          <div class="schedule-item">
            <div style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
                <div>
                    <p class="schedule-title" style="font-size: 1rem; margin-bottom: 0.5rem;">{{ meeting.meet_title }} <span style="font-weight: 500; color: #6b7280;">@ {{ meeting.meet_time|date:"h:i A" }}</span></p>
                    <p class="schedule-desc" style="margin: 0;">Description: {{ meeting.meet_description }}</p>
                    <p class="schedule-desc" style="margin: 0;">For: {{ meeting.job_type }}</p>
                </div>
                <a href="{{ meeting.meet_link }}" target="_blank" class="action-btn" style="text-decoration: none; background-color: #10b981;">Join</a>
            </div>
          </div>
          {% empty %}
          <div class="schedule-item">
            <p style="width: 100%; text-align: center;">No meetings scheduled for today.</p>
          </div>
          {% endfor %}
        </div>
      </div>

      <!-- ===== STAFF DATA FROM DJANGO (SAFE JSON) ===== -->
      <script>
          const staffData = JSON.parse(`[
              {% for r in register_list %}
                  {
                      "job_type": "{{ r.job_type }}"
                  }{% if not forloop.last %},{% endif %}
              {% endfor %}
          ]`);
      </script>

      <script src="{% static 'js/admin/AdminDashboard.js' %}"></script>

      {% endblock %}
    </div>
  </body>
</html>