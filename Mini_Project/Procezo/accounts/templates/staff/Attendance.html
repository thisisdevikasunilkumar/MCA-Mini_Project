{% extends 'staff/Staff Dashboard.html' %}
{% load static %}

{% block title %}Attendance Tracking{% endblock %} 

{% block extrastyle %}
<!-- Dashboard base CSS -->
<link rel="stylesheet" href="{% static 'css/staff/StaffDashboard.css' %}" />
{% endblock %}

{% block content %}
<!-- Include additional CSS -->
<link rel="stylesheet" href="{% static 'css/staff/Attendance.css' %}" />
<div class="main">
  <div class="container">
    <h2>Attendance Tracking</h2>
    <p>Track and manage staff attendance records</p>

    <div class="attendance-stats-grid">
      <div class="attendance-stat-card">
        <div class="stat-icon">✅</div>
        <div class="stat-value">{{ monthly_active_count }}</div>
        <div class="stat-label">Monthly Present</div>
      </div>

      <div class="attendance-stat-card">
        <div class="stat-icon">❌</div>
        <div class="stat-value">{{ monthly_inactive_count }}</div>
        <div class="stat-label">Monthly Inactive</div>
      </div>

      <div class="attendance-stat-card">
        <div class="stat-icon">⏰</div>
        <div class="stat-value">{{ monthly_late_count }}</div>
        <div class="stat-label">Monthly Late Arrivals</div>
      </div>
    </div>

    <div class="card-header">
      <h2>Weekly Attendance Records</h2>
    </div>

    <table class="data-table">
      <thead>
        <tr>
          <th>Date</th>
          <th>Check In</th>
          <th>Check Out</th>
          <th>Overtime Hours</th>
          <th>Status</th>
        </tr>
      </thead>

      <tbody>
        {% for record in attendance_records %}
        <tr>
          <td>{{ record.date|date:"Y-m-d" }}</td> 
          
          <td>{{ record.check_in|default:"--:--" }}</td>
          
          <td>{{ record.check_out|default:"--:--" }}</td>
          
          <td>{{ record.overtime_hours|default:"00:00" }}</td>
          
          <td>
            <span class="status-badge {{ record.status|lower }}">
              {{ record.status }}
            </span>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="5">No attendance records found for this staff member.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    <div class="card-header">
        <h2>Monthly Attendance Calendar</h2>
    </div>

    <p id="monthTitle"></p>
    <div class="calendar" id="attendanceCalendar"></div>

    <!-- SAFE attendance JSON (prevents JS errors) -->
    {{ attendance_map|json_script:"attendance_json" }}

    <script>
        const attendanceData = JSON.parse(
            document.getElementById("attendance_json").textContent
        );
    </script>
  </div>
</div>

<script src="{% static 'js/staff/Attendance.js' %}"></script>
<script src="{% static 'js/staff/StaffDashboard.js' %}"></script>

{% endblock %}