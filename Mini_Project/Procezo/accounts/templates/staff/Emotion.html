{% extends 'staff/Staff Dashboard.html' %}
{% load static %}

{% block title %}Emotion Tracking{% endblock %}

{% block extrastyle %}
  <link rel="stylesheet" href="{% static 'css/staff/StaffDashboard.css' %}">
{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/staff/Emotion.css' %}">

<div class="main">
  <div class="container">

    <h2>Emotion Tracking</h2>
    <p>Monitor emotion and wellbeing</p>

    <div>
      <div class="card-header">
        <h2>How are you feeling today?</h2>
      </div>

      <div class="emotion-grid">

        <div class="emotion-card">
          <div class="emotion-icon">ğŸ˜„</div>
          <div class="emotion-label">Happy</div>
        </div>

        <div class="emotion-card">
          <div class="emotion-icon">ğŸ˜¢</div>
          <div class="emotion-label">Sad</div>
        </div>

        <div class="emotion-card">
          <div class="emotion-icon">ğŸ˜</div>
          <div class="emotion-label">Neutral</div>
        </div>

        <div class="emotion-card">
          <div class="emotion-icon">ğŸ˜ </div>
          <div class="emotion-label">Angry</div>
        </div>

        <div class="emotion-card">
          <div class="emotion-icon">ğŸ˜´</div>
          <div class="emotion-label">Tired</div>
        </div>

        <div class="emotion-card">
          <div class="emotion-icon">ğŸ¤“</div>
          <div class="emotion-label">Focused</div>
        </div>

      </div>
    </div>

<div>
  <div class="card-header">
    <h2>Recent Emotion Reports</h2>
  </div>

<table class="data-table">
  <thead>
    <tr>
      <th>Staff ID</th>
      <th>Staff Name</th>
      <th>Date</th>
      <th>Time</th>
      <th>Emotion</th>
      <th>Status</th>
    </tr>
  </thead>

  <tbody>
    {% for emo in all_emotions %}
    <tr>
      <td>{{ staff.staff_id }}</td>
      <td>{{ staff.name }}</td>

      <td>{{ emo.timestamp|date:"d-m-Y" }}</td>
      <td>{{ emo.timestamp|time:"h:i A" }}</td>

      <td>
        {% if emo.emotion_type == "Happy" %}
          ğŸ˜„ Happy
        {% elif emo.emotion_type == "Sad" %}
          ğŸ˜¢ Sad
        {% elif emo.emotion_type == "Neutral" %}
          ğŸ˜ Neutral
        {% elif emo.emotion_type == "Angry" %}
          ğŸ˜¡ Angry
        {% elif emo.emotion_type == "Tired" %}
          ğŸ˜ª Tired
        {% elif emo.emotion_type == "Focused" %}
          ğŸ¯ Focused
        {% endif %}
      </td>

      <td>
        {% if emo.emotion_type in "Happy Focused" %}
          <span class="status-badge positive">Positive</span>
        {% elif emo.emotion_type == "Neutral" %}
          <span class="status-badge neutral">Neutral</span>
        {% else %}
          <span class="status-badge negative">Negative</span>
        {% endif %}
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>


</div>

    <div class="messages-section">
      <div class="messages-header">
          <h3>ğŸ“© Messages from Admin</h3>
          <span class="message-count" id="message-count">
              {{ feedback_count }} New
          </span>
      </div>

      <div class="messages-list" id="messages-list">
        {% for f in feedback_list %}
        <div class="message-card urgent" data-message-id="{{ f.feedback_id }}">
          <div class="message-header">
            <div class="message-info">
              <div class="message-time">{{ f.created_at|timesince }} ago</div>
            </div>
          </div>

          <div class="message-body">
            {% if f.message %}
              {{ f.message }}
            {% elif f.current_problem %}
              {{ f.current_problem }}
            {% endif %}
          </div>

          <div class="message-actions">
            <button class="reply-btn" onclick="toggleReply({{ f.feedback_id }})">
              ğŸ’¬ Reply to Admin
            </button>
          </div>

          <div class="reply-section" id="reply-section-{{ f.feedback_id }}">
            <textarea class="reply-textarea" id="reply-textarea-{{ f.feedback_id }}" placeholder="Type your response to admin here...">{{ f.current_problem }}</textarea>

            <div class="reply-actions">
              <button class="send-reply-btn" onclick="sendReply({{f.feedback_id }})">
                âœ‰ï¸ Send Reply
              </button>
              <button class="cancel-reply-btn" onclick="cancelReply({{f.feedback_id }})">Cancel</button>
            </div>

            <div class="success-message" id="success-message-{{ f.feedback_id }}">
              âœ… Reply sent successfully to admin!
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>

    <div>
      <div class="card-header">
        <h2>Wellbeing Tips</h2>
      </div>

      <div style="display: flex; flex-direction: column; gap: 1rem;">

        <div class="schedule-item">
          <div class="schedule-details">
            <h3>Take Regular Breaks ğŸ’ª</h3>
            <p>Step away from your desk every hour for a quick stretch or walk</p>
          </div>
        </div>

        <div class="schedule-item">
          <div class="schedule-details">
            <h3>Stay Hydrated ğŸ’§</h3>
            <p>Drink water throughout the day to maintain focus and energy</p>
          </div>
        </div>

        <div class="schedule-item">
          <div class="schedule-details">
            <h3>Practice Mindfulness ğŸ§˜</h3>
            <p>Take 5 minutes for deep breathing exercises when feeling stressed</p>
          </div>
        </div>

      </div>
    </div>

  </div>
</div>

<script src="{% static 'js/staff/Emotion.js' %}"></script>
<script src="{% static 'js/staff/StaffDashboard.js' %}"></script>
{% endblock %}